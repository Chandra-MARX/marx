# -*- sh -*-

@SET_MAKE@
SHELL = /bin/sh

BINDIR = bin/$(ARCH)
LIBDIR = lib/$(ARCH)
INCDIR = ./include

MARX_EXECS = marx geff marx2dpde dumpwfold marx2fits \
  bestfocus marx2img marxcat pileup detinfo marxasp

PFILE_EXECS = pset plist pwhich
JDFITS_EXECS = fitsdump

all:
	cd jdmath; $(MAKE) all
	cd pfile; $(MAKE) all
	cd jdfits; $(MAKE) all
	cd marx; $(MAKE) all
	@echo 
	-mkdir bin
	-mkdir $(BINDIR)
	@for exe in $(MARX_EXECS); do \
		echo Installing $$exe; \
		cp marx/src/$(ARCH)objs/$$exe $(BINDIR); \
	done
	@for exe in $(PFILE_EXECS); do \
		echo Installing $$exe; \
		cp pfile/src/$(ARCH)objs/$$exe $(BINDIR); \
	done
	@for exe in $(JDFITS_EXECS); do \
		echo Installing $$exe; \
		cp jdfits/src/$(ARCH)objs/$$exe $(BINDIR); \
	done
	cp tools/scripts/xspec2marx $(BINDIR)
	chmod ugo+x $(BINDIR)/xspec2marx
	@echo 
	@echo Installing libraries
	@echo
	-mkdir lib
	-mkdir $(LIBDIR)
	-mkdir $(INCDIR)
	-cp pfile/src/pfile.h $(INCDIR)
	-cp pfile/src/$(ARCH)objs/libpfile.a $(LIBDIR)
	-cp jdmath/src/jdmath.h $(INCDIR)
	-cp jdmath/src/$(ARCH)objs/libjdmath.a $(LIBDIR)
	-cp marx/libsrc/marx.h $(INCDIR)
	-cp marx/libsrc/$(ARCH)objs/libmarx.a $(LIBDIR)
	-cp jdfits/src/jdfits.h $(INCDIR)
	-cp jdfits/src/$(ARCH)objs/libjdfits.a $(LIBDIR)
	-cp marx/par/marx.par .
	-cp marx/par/marxasp.par .
	-cp marx/par/pileup.par .
	@echo 
	@echo marx is in the $(BINDIR) directory.
	@echo marx.par and pileup.par are in the current directory.  
	@echo 
	@echo Before running the program, set the environment variable MARX_DATA_DIR
	@echo  to `pwd`/marx/data.
#
clean:
	cd jdmath; $(MAKE) clean
	cd pfile; $(MAKE) clean
	cd jdfits; $(MAKE) clean
	cd marx; $(MAKE) clean
confclean:
	cd jdmath; $(MAKE) confclean
	cd pfile; $(MAKE) confclean
	cd jdfits; $(MAKE) confclean
	cd marx; $(MAKE) confclean
	-/bin/rm -f config.cache config.status config.log
	-/bin/rm -f Makefile
distclean:
	-/bin/rm -rf $(BINDIR)
	-/bin/rm -f *~ marx.par
	-/bin/rm -f config.cache config.status config.log
	-cd jdmath; $(MAKE) distclean
	-cd pfile; $(MAKE) distclean
	-cd jdfits; $(MAKE) distclean
	-cd marx; $(MAKE) distclean
	-/bin/rm -f Makefile
#end of file
